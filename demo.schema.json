{
  "$id": "https://demoscript.dev/demo.schema.json",
  "title": "DemoScript Configuration",
  "description": "Schema for DemoScript demo YAML files",
  "type": "object",
  "required": ["title", "steps"],
  "properties": {
    "title": {
      "type": "string",
      "description": "Demo title"
    },
    "description": {
      "type": "string",
      "description": "Demo description"
    },
    "version": {
      "type": "string",
      "description": "Demo version"
    },
    "author": {
      "type": "string",
      "description": "Demo author"
    },
    "tags": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Tags for categorization"
    },
    "metadata": { "$ref": "#/$defs/DemoMetadata" },
    "settings": { "$ref": "#/$defs/DemoSettings" },
    "steps": {
      "type": "array",
      "items": { "$ref": "#/$defs/StepOrGroup" },
      "description": "Array of demo steps or step groups"
    }
  },
  "$defs": {
    "DemoSettings": {
      "type": "object",
      "properties": {
        "base_url": {
          "type": "string",
          "format": "uri",
          "description": "Base URL for REST API calls"
        },
        "openapi": {
          "type": "string",
          "format": "uri",
          "description": "OpenAPI spec URL for auto-generating form fields"
        },
        "theme": { "$ref": "#/$defs/ThemeSettings" },
        "polling": { "$ref": "#/$defs/PollingDefaults" },
        "links": {
          "type": "object",
          "additionalProperties": { "$ref": "#/$defs/LinkHandler" }
        },
        "effects": { "$ref": "#/$defs/EffectsSettings" },
        "auth": { "$ref": "#/$defs/AuthSettings" },
        "dashboard": { "$ref": "#/$defs/DashboardSettings" },
        "sidebar": { "$ref": "#/$defs/SidebarSettings" },
        "health_checks": {
          "type": "array",
          "items": { "$ref": "#/$defs/HealthCheck" },
          "description": "Service health check endpoints"
        }
      }
    },
    "EffectsSettings": {
      "type": "object",
      "description": "Visual effects configuration",
      "properties": {
        "confetti": {
          "type": "boolean",
          "description": "Fire confetti on step completion (default: true)"
        },
        "sounds": {
          "type": "boolean",
          "description": "Play success/error sounds (default: true)"
        },
        "transitions": {
          "type": "boolean",
          "description": "Animate step changes (default: true)"
        },
        "counters": {
          "type": "boolean",
          "description": "Animate numeric values (default: true)"
        },
        "neon_glow": {
          "type": "boolean",
          "description": "Neon text effects in dark mode (default: true)"
        },
        "grid_background": {
          "type": "boolean",
          "description": "Animated grid background in dark mode (default: true)"
        },
        "glow_orbs": {
          "type": "boolean",
          "description": "Floating glow orbs in dark mode (default: true)"
        },
        "sound_volume": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Sound volume (0-1, default: 0.3)"
        }
      }
    },
    "AuthSettings": {
      "type": "object",
      "description": "Authentication settings for protected demos",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable password protection (default: false)"
        },
        "password": {
          "type": "string",
          "description": "Password required to view the demo"
        },
        "password_hash": {
          "type": "string",
          "description": "SHA-256 hash of password (for static builds)"
        },
        "message": {
          "type": "string",
          "description": "Custom message on login screen"
        },
        "title": {
          "type": "string",
          "description": "Custom title on login screen"
        }
      }
    },
    "DashboardSettings": {
      "type": "object",
      "description": "Dashboard/overview screen settings",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Show dashboard on demo load (default: false)"
        },
        "show_stats": {
          "type": "boolean",
          "description": "Show step count and duration estimate (default: true)"
        },
        "show_health": {
          "type": "boolean",
          "description": "Show service health status (default: true)"
        },
        "show_description": {
          "type": "boolean",
          "description": "Show demo description (default: true)"
        },
        "data_cards": {
          "type": "array",
          "items": { "$ref": "#/$defs/DataCard" },
          "description": "Live data stat cards"
        },
        "data_lists": {
          "type": "array",
          "items": { "$ref": "#/$defs/DataList" },
          "description": "Data lists (transactions, items)"
        }
      }
    },
    "DataCard": {
      "type": "object",
      "required": ["label"],
      "description": "Dashboard stat card configuration",
      "properties": {
        "label": {
          "type": "string",
          "description": "Card label"
        },
        "url": {
          "type": "string",
          "description": "API endpoint URL (supports ${base_url})"
        },
        "value": {
          "oneOf": [{ "type": "string" }, { "type": "number" }],
          "description": "JSON path to extract value or static value"
        },
        "type": {
          "type": "string",
          "enum": ["number", "text", "currency", "link"],
          "description": "Value display type (default: text)"
        },
        "poll_interval": {
          "type": "integer",
          "minimum": 1000,
          "description": "Polling interval in ms"
        }
      }
    },
    "DataList": {
      "type": "object",
      "required": ["label", "url", "items"],
      "description": "Dashboard data list configuration",
      "properties": {
        "label": {
          "type": "string",
          "description": "List header label"
        },
        "url": {
          "type": "string",
          "description": "API endpoint URL"
        },
        "items": {
          "type": "string",
          "description": "JSON path to array (empty for root)"
        },
        "layout": {
          "type": "string",
          "enum": ["cards", "table"],
          "description": "Display layout (default: cards)"
        },
        "limit": {
          "type": "integer",
          "minimum": 1,
          "description": "Limit number of items"
        },
        "poll_interval": {
          "type": "integer",
          "minimum": 1000,
          "description": "Polling interval in ms"
        },
        "empty_message": {
          "type": "string",
          "description": "Message when list is empty"
        },
        "card": { "$ref": "#/$defs/CardLayoutConfig" },
        "columns": {
          "type": "array",
          "items": { "$ref": "#/$defs/TableColumnConfig" }
        }
      }
    },
    "CardLayoutConfig": {
      "type": "object",
      "required": ["title"],
      "description": "Card layout configuration for data lists",
      "properties": {
        "badges": {
          "type": "array",
          "items": { "$ref": "#/$defs/BadgeConfig" }
        },
        "title": {
          "type": "object",
          "required": ["key"],
          "properties": {
            "key": { "type": "string" },
            "type": {
              "type": "string",
              "enum": ["text", "currency", "number"]
            },
            "prefix_key": { "type": "string" },
            "suffix_key": { "type": "string" }
          }
        },
        "fields": {
          "type": "array",
          "items": { "$ref": "#/$defs/DataListField" }
        }
      }
    },
    "BadgeConfig": {
      "type": "object",
      "required": ["key"],
      "properties": {
        "key": { "type": "string" },
        "label": { "type": "string" },
        "variants": {
          "type": "object",
          "additionalProperties": {
            "type": "string",
            "enum": ["success", "info", "warning", "error", "default"]
          }
        }
      }
    },
    "DataListField": {
      "type": "object",
      "required": ["key"],
      "properties": {
        "key": { "type": "string" },
        "label": { "type": "string" },
        "type": {
          "type": "string",
          "enum": ["text", "address", "tx", "token", "currency", "mono", "relative_time", "link"]
        },
        "link": { "type": "string" }
      }
    },
    "TableColumnConfig": {
      "type": "object",
      "required": ["key", "label"],
      "properties": {
        "key": { "type": "string" },
        "label": { "type": "string" },
        "type": {
          "type": "string",
          "enum": ["text", "address", "tx", "token", "currency", "mono", "relative_time", "link"]
        },
        "link": { "type": "string" }
      }
    },
    "SidebarSettings": {
      "type": "object",
      "description": "Sidebar navigation settings",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable sidebar navigation (default: false)"
        },
        "collapsed": {
          "type": "boolean",
          "description": "Start sidebar collapsed (default: false)"
        },
        "show_status": {
          "type": "boolean",
          "description": "Show step completion status (default: true)"
        }
      }
    },
    "HealthCheck": {
      "type": "object",
      "required": ["name", "url"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Display name for the service"
        },
        "url": {
          "type": "string",
          "description": "Health check endpoint URL"
        },
        "method": {
          "type": "string",
          "enum": ["GET", "HEAD"],
          "description": "HTTP method (default: GET)"
        },
        "interval": {
          "type": "integer",
          "minimum": 1000,
          "description": "Polling interval in ms (default: 10000)"
        }
      }
    },
    "DemoMetadata": {
      "type": "object",
      "description": "Additional demo metadata for gallery display",
      "properties": {
        "duration": {
          "type": "string",
          "description": "Estimated duration (e.g., '5 minutes')"
        },
        "difficulty": {
          "type": "string",
          "enum": ["beginner", "intermediate", "advanced"],
          "description": "Difficulty level"
        },
        "category": {
          "type": "string",
          "description": "Demo category"
        },
        "thumbnail": {
          "type": "string",
          "description": "Thumbnail image URL or path"
        }
      }
    },
    "ThemeSettings": {
      "type": "object",
      "properties": {
        "logo": { "type": "string" },
        "primary_color": { "type": "string" }
      }
    },
    "PollingDefaults": {
      "type": "object",
      "properties": {
        "interval": { "type": "integer", "minimum": 100 },
        "max_attempts": { "type": "integer", "minimum": 1 }
      }
    },
    "LinkHandler": {
      "type": "object",
      "properties": {
        "address": { "type": "string" },
        "tx": { "type": "string" },
        "token": { "type": "string" }
      }
    },
    "BaseStep": {
      "type": "object",
      "properties": {
        "title": { "type": "string", "description": "Step title" },
        "id": { "type": "string", "description": "Unique identifier for goto targets" },
        "goto": { "type": "string", "description": "Step ID to navigate to after completion" }
      }
    },
    "Choice": {
      "type": "object",
      "required": ["label", "goto"],
      "properties": {
        "label": { "type": "string" },
        "description": { "type": "string" },
        "goto": { "type": "string" }
      }
    },
    "FormField": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": { "type": "string" },
        "label": { "type": "string" },
        "type": { "enum": ["text", "number", "select", "textarea", "toggle", "slider"] },
        "default": { "oneOf": [{ "type": "string" }, { "type": "number" }, { "type": "boolean" }] },
        "required": { "type": "boolean" },
        "readonly": { "type": "boolean" },
        "hidden": { "type": "boolean" },
        "placeholder": { "type": "string" },
        "options": {
          "type": "array",
          "items": { "$ref": "#/$defs/SelectOption" }
        },
        "min": { "type": "number", "description": "Minimum value for slider" },
        "max": { "type": "number", "description": "Maximum value for slider" },
        "step": { "type": "number", "description": "Step increment for slider" }
      }
    },
    "SelectOption": {
      "type": "object",
      "required": ["label", "value"],
      "properties": {
        "label": { "type": "string" },
        "value": { "type": "string" }
      }
    },
    "ResultField": {
      "type": "object",
      "required": ["key"],
      "properties": {
        "key": { "type": "string" },
        "label": { "type": "string" },
        "type": { "enum": ["text", "address", "tx", "token", "link", "currency", "code", "table", "json", "mono", "relative_time"] },
        "link": { "type": "string" },
        "format": { "type": "string" },
        "columns": {
          "type": "array",
          "items": { "$ref": "#/$defs/TableColumn" }
        },
        "expandedDepth": { "type": "integer", "minimum": 0, "description": "Levels to auto-expand in JSON viewer (default: 2)" }
      }
    },
    "TableColumn": {
      "type": "object",
      "required": ["key", "label"],
      "properties": {
        "key": { "type": "string" },
        "label": { "type": "string" }
      }
    },
    "PollingConfig": {
      "type": "object",
      "required": ["endpoint", "success_when"],
      "properties": {
        "endpoint": { "type": "string" },
        "success_when": { "type": "string" },
        "failure_when": { "type": "string" },
        "interval": { "type": "integer", "minimum": 100 },
        "max_attempts": { "type": "integer", "minimum": 1 },
        "save": {
          "type": "object",
          "additionalProperties": { "type": "string" }
        }
      }
    },
    "StepOrGroup": {
      "oneOf": [
        { "$ref": "#/$defs/StepGroup" },
        { "$ref": "#/$defs/Step" }
      ]
    },
    "StepGroup": {
      "type": "object",
      "required": ["group", "steps"],
      "properties": {
        "group": { "type": "string", "description": "Group name" },
        "description": { "type": "string" },
        "collapsed": { "type": "boolean", "description": "Start collapsed" },
        "steps": {
          "type": "array",
          "items": { "$ref": "#/$defs/Step" }
        }
      }
    },
    "Step": {
      "oneOf": [
        { "$ref": "#/$defs/SlideStep" },
        { "$ref": "#/$defs/SlideStepExplicit" },
        { "$ref": "#/$defs/RestStep" },
        { "$ref": "#/$defs/RestStepExplicit" },
        { "$ref": "#/$defs/ShellStep" },
        { "$ref": "#/$defs/ShellStepExplicit" },
        { "$ref": "#/$defs/BrowserStep" },
        { "$ref": "#/$defs/BrowserStepExplicit" },
        { "$ref": "#/$defs/CodeStep" },
        { "$ref": "#/$defs/CodeStepExplicit" },
        { "$ref": "#/$defs/WaitStep" },
        { "$ref": "#/$defs/WaitStepExplicit" },
        { "$ref": "#/$defs/AssertStep" },
        { "$ref": "#/$defs/AssertStepExplicit" },
        { "$ref": "#/$defs/GraphQLStep" },
        { "$ref": "#/$defs/GraphQLStepExplicit" },
        { "$ref": "#/$defs/DatabaseStep" },
        { "$ref": "#/$defs/DatabaseStepExplicit" }
      ]
    },
    "SlideStep": {
      "type": "object",
      "required": ["slide"],
      "properties": {
        "slide": { "type": "string", "description": "Markdown content" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "choices": {
          "type": "array",
          "items": { "$ref": "#/$defs/Choice" }
        }
      }
    },
    "SlideStepExplicit": {
      "type": "object",
      "required": ["step", "content"],
      "properties": {
        "step": { "const": "slide" },
        "content": { "type": "string", "description": "Markdown content" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "choices": {
          "type": "array",
          "items": { "$ref": "#/$defs/Choice" }
        }
      }
    },
    "RestStep": {
      "type": "object",
      "required": ["rest"],
      "properties": {
        "rest": { "type": "string", "description": "HTTP method and endpoint (e.g., 'GET /users')" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "description": { "type": "string" },
        "base_url": { "type": "string" },
        "openapi": { "type": "string", "format": "uri", "description": "Per-step OpenAPI spec URL override" },
        "headers": { "type": "object", "additionalProperties": { "type": "string" } },
        "body": { "type": "object" },
        "form": { "type": "array", "items": { "$ref": "#/$defs/FormField" } },
        "defaults": { "type": "object", "description": "Default values for OpenAPI-generated form fields" },
        "save": { "type": "object", "additionalProperties": { "type": "string" } },
        "results": { "type": "array", "items": { "$ref": "#/$defs/ResultField" } },
        "wait_for": { "type": "string" },
        "poll": { "$ref": "#/$defs/PollingConfig" },
        "show_curl": { "type": "boolean", "description": "Show curl command for this request (default: false)" }
      }
    },
    "RestStepExplicit": {
      "type": "object",
      "required": ["step", "method", "path"],
      "properties": {
        "step": { "const": "rest" },
        "method": { "enum": ["GET", "POST", "PUT", "PATCH", "DELETE"] },
        "path": { "type": "string", "description": "API endpoint path" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "description": { "type": "string" },
        "base_url": { "type": "string" },
        "openapi": { "type": "string", "format": "uri", "description": "Per-step OpenAPI spec URL override" },
        "headers": { "type": "object", "additionalProperties": { "type": "string" } },
        "body": { "type": "object" },
        "form": { "type": "array", "items": { "$ref": "#/$defs/FormField" } },
        "defaults": { "type": "object", "description": "Default values for OpenAPI-generated form fields" },
        "save": { "type": "object", "additionalProperties": { "type": "string" } },
        "results": { "type": "array", "items": { "$ref": "#/$defs/ResultField" } },
        "wait_for": { "type": "string" },
        "poll": { "$ref": "#/$defs/PollingConfig" },
        "show_curl": { "type": "boolean", "description": "Show curl command for this request (default: false)" }
      }
    },
    "ShellStep": {
      "type": "object",
      "required": ["shell"],
      "properties": {
        "shell": { "type": "string", "description": "Shell command to execute" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "description": { "type": "string" },
        "shell_type": { "enum": ["bash", "powershell", "cmd"] },
        "workdir": { "type": "string" },
        "confirm": { "type": "boolean" },
        "env": { "type": "object", "additionalProperties": { "type": "string" } },
        "save": { "type": "object", "additionalProperties": { "type": "string" } }
      }
    },
    "ShellStepExplicit": {
      "type": "object",
      "required": ["step", "command"],
      "properties": {
        "step": { "const": "shell" },
        "command": { "type": "string", "description": "Shell command to execute" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "description": { "type": "string" },
        "shell_type": { "enum": ["bash", "powershell", "cmd"] },
        "workdir": { "type": "string" },
        "confirm": { "type": "boolean" },
        "env": { "type": "object", "additionalProperties": { "type": "string" } },
        "save": { "type": "object", "additionalProperties": { "type": "string" } }
      }
    },
    "BrowserStep": {
      "type": "object",
      "required": ["browser"],
      "properties": {
        "browser": { "type": "string", "description": "URL to open" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "description": { "type": "string" },
        "screenshot": { "type": "string" }
      }
    },
    "BrowserStepExplicit": {
      "type": "object",
      "required": ["step", "url"],
      "properties": {
        "step": { "const": "browser" },
        "url": { "type": "string", "description": "URL to open" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "description": { "type": "string" },
        "screenshot": { "type": "string" }
      }
    },
    "CodeStep": {
      "type": "object",
      "required": ["code"],
      "properties": {
        "code": { "type": "string", "description": "Source code to display" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "language": { "type": "string" },
        "filename": { "type": "string" },
        "highlight": { "type": "array", "items": { "type": "integer" } }
      }
    },
    "CodeStepExplicit": {
      "type": "object",
      "required": ["step", "source"],
      "properties": {
        "step": { "const": "code" },
        "source": { "type": "string", "description": "Source code to display" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "language": { "type": "string" },
        "filename": { "type": "string" },
        "highlight": { "type": "array", "items": { "type": "integer" } }
      }
    },
    "WaitStep": {
      "type": "object",
      "required": ["wait"],
      "properties": {
        "wait": { "type": "integer", "minimum": 0, "description": "Duration in milliseconds" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "message": { "type": "string" }
      }
    },
    "WaitStepExplicit": {
      "type": "object",
      "required": ["step", "duration"],
      "properties": {
        "step": { "const": "wait" },
        "duration": { "type": "integer", "minimum": 0, "description": "Duration in milliseconds" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "message": { "type": "string" }
      }
    },
    "AssertStep": {
      "type": "object",
      "required": ["assert"],
      "properties": {
        "assert": { "type": "string", "description": "Condition expression (e.g., '$userId == 1')" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "message": { "type": "string" },
        "description": { "type": "string" }
      }
    },
    "AssertStepExplicit": {
      "type": "object",
      "required": ["step", "condition"],
      "properties": {
        "step": { "const": "assert" },
        "condition": { "type": "string", "description": "Condition expression (e.g., '$userId == 1')" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "message": { "type": "string" },
        "description": { "type": "string" }
      }
    },
    "GraphQLStep": {
      "type": "object",
      "required": ["graphql"],
      "properties": {
        "graphql": { "type": "string", "description": "GraphQL query or mutation" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "endpoint": { "type": "string" },
        "variables": { "type": "object" },
        "headers": { "type": "object", "additionalProperties": { "type": "string" } },
        "save": { "type": "object", "additionalProperties": { "type": "string" } },
        "results": { "type": "array", "items": { "$ref": "#/$defs/ResultField" } }
      }
    },
    "GraphQLStepExplicit": {
      "type": "object",
      "required": ["step", "query"],
      "properties": {
        "step": { "const": "graphql" },
        "query": { "type": "string", "description": "GraphQL query or mutation" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "endpoint": { "type": "string" },
        "variables": { "type": "object" },
        "headers": { "type": "object", "additionalProperties": { "type": "string" } },
        "save": { "type": "object", "additionalProperties": { "type": "string" } },
        "results": { "type": "array", "items": { "$ref": "#/$defs/ResultField" } }
      }
    },
    "DatabaseStep": {
      "type": "object",
      "required": ["db"],
      "properties": {
        "db": { "type": "string", "description": "Database operation (find, findOne, insertOne, updateOne, deleteOne, query)" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "description": { "type": "string" },
        "type": { "enum": ["mongodb", "postgres", "mysql"] },
        "collection": { "type": "string" },
        "table": { "type": "string" },
        "query": { "oneOf": [{ "type": "object" }, { "type": "string" }] },
        "update": { "type": "object" },
        "document": { "type": "object" },
        "projection": { "type": "object", "additionalProperties": { "type": "integer" } },
        "save": { "type": "object", "additionalProperties": { "type": "string" } },
        "results": { "type": "array", "items": { "$ref": "#/$defs/ResultField" } }
      }
    },
    "DatabaseStepExplicit": {
      "type": "object",
      "required": ["step", "operation"],
      "properties": {
        "step": { "const": "db" },
        "operation": { "type": "string", "description": "Database operation (find, findOne, insertOne, updateOne, deleteOne, query)" },
        "title": { "type": "string" },
        "id": { "type": "string" },
        "goto": { "type": "string" },
        "description": { "type": "string" },
        "type": { "enum": ["mongodb", "postgres", "mysql"] },
        "collection": { "type": "string" },
        "table": { "type": "string" },
        "query": { "oneOf": [{ "type": "object" }, { "type": "string" }] },
        "update": { "type": "object" },
        "document": { "type": "object" },
        "projection": { "type": "object", "additionalProperties": { "type": "integer" } },
        "save": { "type": "object", "additionalProperties": { "type": "string" } },
        "results": { "type": "array", "items": { "$ref": "#/$defs/ResultField" } }
      }
    }
  }
}
